<!doctype html>

<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Umandana Translator — Versi Perbaikan</title>
  <style>
    :root{--bg:#0f172a;--card:#111827;--muted:#9ca3af;--text:#e5e7eb;--brand:#6366f1;--brand2:#22c55e}
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 600px at 70% -10%,rgba(99,102,241,.25),transparent),radial-gradient(900px 500px at 10% 10%,rgba(34,197,94,.2),transparent),var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    .wrap{max-width:1000px;margin:24px auto;padding:16px}
    .title{font-size:clamp(24px,2.8vw,36px);font-weight:800;letter-spacing:.2px;text-align:center;margin:8px 0 18px}
    .subtitle{color:var(--muted);text-align:center;margin-top:-6px;margin-bottom:18px}
    .grid{display:grid;gap:16px;grid-template-columns:1fr;}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);backdrop-filter: blur(8px);border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,.35)}
    .card h3{margin:0 0 8px;font-size:15px;color:#cbd5e1}
    .card .body{padding:14px}
    textarea{width:100%;min-height:220px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0b1020;color:var(--text);padding:12px;outline:none}
    textarea:focus{border-color:rgba(99,102,241,.7);box-shadow:0 0 0 3px rgba(99,102,241,.25)}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(255,255,255,.12);background:#0b1020;color:#eef1f7;padding:10px 14px;border-radius:12px;cursor:pointer}
    .btn:hover{border-color:rgba(255,255,255,.25)}
    .btn.primary{background:linear-gradient(135deg,var(--brand),#8b5cf6);border-color:transparent}
    .btn.success{background:linear-gradient(135deg,var(--brand2),#16a34a);border-color:transparent}
    .muted{color:var(--muted);font-size:13px}
    .opts{display:grid;grid-template-columns:1fr;gap:8px}
    @media(min-width:700px){.opts{grid-template-columns:1fr 1fr 1fr}}
    .opt{display:flex;align-items:center;gap:8px;padding:10px 12px;background:#0b1020;border:1px solid rgba(255,255,255,.08);border-radius:12px}
    .badge{display:inline-flex;align-items:center;gap:6px;font-size:12px;padding:6px 10px;border-radius:999px;border:1px dashed rgba(255,255,255,.2);color:#cbd5e1}
    .counter{font-size:12px;color:#cbd5e1;margin-top:6px;display:flex;gap:14px}
    .bubble{animation:pop .5s ease forwards;display:inline-block}
    @keyframes pop{from{transform:translateY(6px) scale(.98);opacity:.0} to{transform:translateY(0) scale(1);opacity:1}}
    .footer{opacity:.7;text-align:center;font-size:12px;margin:18px 0}
    a{color:#c7d2fe}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">Umandana Translator</div>
    <div class="subtitle">Versi perbaikan: aturan vokal/NG dibenahi, opsi ES fleksibel, copy/share, unduh TXT.</div><div class="grid">
  <div class="card">
    <div class="body">
      <h3>Teks Asli</h3>
      <textarea id="src" placeholder="Tulis teks di sini…"></textarea>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="clearBtn">Bersihkan</button>
        <span class="badge">Karakter: <span id="srcChars">0</span></span>
        <span class="badge">Kata: <span id="srcWords">0</span></span>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="body">
      <h3>Hasil Umandana</h3>
      <textarea id="dst" readonly></textarea>
      <div class="row" style="margin-top:8px">
        <button class="btn primary" id="copyBtn">Salin</button>
        <button class="btn" id="shareBtn">Bagikan</button>
        <button class="btn success" id="downloadBtn">Unduh .txt</button>
        <span class="badge">Karakter: <span id="dstChars">0</span></span>
      </div>
    </div>
  </div>
</div>

<div class="card" style="margin-top:16px">
  <div class="body">
    <div class="row" style="justify-content:space-between;align-items:center">
      <div class="row">
        <label class="opt"><input type="checkbox" id="endOnly" checked> ES hanya di <b>konsonan akhir kata</b></label>
        <label class="opt"><input type="checkbox" id="strict"> Mode ketat: <b>semua konsonan +ES</b></label>
        <label class="opt"><input type="checkbox" id="upper" checked> Hasil <b>huruf besar</b></label>
      </div>
      <span class="muted">Aturan: I→IPRI, U→UPRU, E→EPRE, O→OPRO, A tetap A, NG→STRENG.</span>
    </div>
  </div>
</div>

<div class="footer">© 2025 — Umandana Translator. Dibuat untuk latihan & konten. <a href="#" id="how">Lihat contoh</a></div>

  </div><script>
(function(){
  const el = (id)=>document.getElementById(id);
  const src = el('src');
  const dst = el('dst');
  const copyBtn = el('copyBtn');
  const clearBtn = el('clearBtn');
  const shareBtn = el('shareBtn');
  const downloadBtn = el('downloadBtn');
  const endOnly = el('endOnly');
  const strict = el('strict');
  const upper = el('upper');
  const srcChars = el('srcChars');
  const srcWords = el('srcWords');
  const dstChars = el('dstChars');
  const how = el('how');

  function isLetter(ch){ return /[A-Za-z]/.test(ch); }
  function isVowel(ch){ return /[AEIOUaeiou]/.test(ch); }

  const vokalMap = {
    A: 'AIDEN', a:'aiden',
    I: 'IPRI', i:'ipri',
    U: 'UPRU', u:'upru',
    E: 'EPRE', e:'epre',
    O: 'OPRO', o:'opro'
  };

  function plusEs(ch, up){
    const base = up ? ch.toUpperCase() : ch.toLowerCase();
    return base + (up ? 'ES':'es');
  }

  function convert(input){
    if(!input) return '';
    const up = upper.checked;
    const useEndOnly = endOnly.checked && !strict.checked;

    const words = input.split(/(\s+)/); // pertahankan spasi
    const converted = words.map(token=>{
      if(/^\s+$/.test(token)) return token; // spasi

      const parts = token.match(/[A-Za-z]+|[^A-Za-z]+/g) || [token];
      const convParts = parts.map(part=>{
        if(!/[A-Za-z]/.test(part)) return part; // tanda baca tetap
        let out='';
        const letters = part.split('');
        for(let i=0;i<letters.length;i++){
          const ch = letters[i];
          const next = letters[i+1]||'';

          // NG → STRENG (semua posisi)
          if((ch==='N'||ch==='n') && (next==='G'||next==='g')){
            out += up ? 'STRENG':'streng';
            i++; // skip G
            continue;
          }

          // Vokal
          if(isVowel(ch)){
            out += vokalMap[ch] ?? ch;
            continue;
          }

          // Konsonan
          if(isLetter(ch)){
            if(strict.checked){
              out += plusEs(ch, up);
            } else {
              out += up ? ch.toUpperCase() : ch.toLowerCase();
            }
            continue;
          }

          out += ch;
        }

        if(useEndOnly){
          const lastAlpha = (part.match(/[A-Za-z](?=[^A-Za-z]*$)/)||[''])[0];
          if(lastAlpha && !isVowel(lastAlpha)){
            const endsWithStreng = out.endsWith(up?'STRENG':'streng');
            if(!endsWithStreng) out += up?'ES':'es';
          }
        }
        return out;
      });
      return convParts.join('');
    });

    return converted.join('');
  }

  function update(){
    const val = src.value;
    dst.value = convert(val);
    // counter
    srcChars.textContent = val.length;
    srcWords.textContent = (val.trim()? val.trim().split(/\s+/).length : 0);
    dstChars.textContent = dst.value.length;
    // animasi bubble kecil saat update
    dst.classList.remove('bubble');
    void dst.offsetWidth; // reflow
    dst.classList.add('bubble');
  }

  src.addEventListener('input', update);
  endOnly.addEventListener('change', update);
  strict.addEventListener('change', ()=>{ if(strict.checked) endOnly.checked=false; update(); });
  upper.addEventListener('change', update);

  clearBtn.addEventListener('click', ()=>{ src.value=''; update(); src.focus(); });
  copyBtn.addEventListener('click', async ()=>{
    try{ await navigator.clipboard.writeText(dst.value); alert('Hasil Umandana disalin!'); }
    catch(e){ alert('Gagal menyalin: '+e.message); }
  });
  shareBtn.addEventListener('click', async ()=>{
    const text = dst.value || '';
    if(navigator.share){
      try{ await navigator.share({title:'Umandana',text}); }
      catch(e){ /* batal */ }
    } else {
      alert('Peramban belum mendukung tombol Bagikan. Silakan salin teks.');
    }
  });
  downloadBtn.addEventListener('click', ()=>{
    const blob = new Blob([dst.value], {type:'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'umandana.txt'; a.click();
    URL.revokeObjectURL(url);
  });

  how.addEventListener('click', (e)=>{
    e.preventDefault();
    const contoh = [
      ['RUMAH','RUPRU MAHES'],
      ['ASING','AIDEN SIPRI STRENG'],
      ['MATA','MAIDEN TAIDEN'],
      ['BOLA','BOPRO LAIDEN'],
      ['DUNIA','DUPRU NIPRI A']
    ].map(([a,b])=>`• ${a} → ${b}`).join('\n');
    alert('Contoh:\n'+contoh+'\n\nAturan:\nI→IPRI\nU→UPRU\nE→EPRE\nO→OPRO\nA tetap A\nNG→STRENG');
  });

  // seed demo
  src.value = 'KITA PERGI MAKAN DI RUMAH TEMAN MALAM INI';
  update();
})();
</script></body>
</html>
