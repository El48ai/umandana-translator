<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="theme-color" content="#0f172a">
  <title>Umandana Translator â€” Dua Arah</title>
  <link rel="manifest" href="/manifest.json">
  <style>
    :root{
      --bg:#0f172a; --card:#111827; --muted:#9ca3af; --text:#e5e7eb;
      --brand:#6366f1; --brand2:#22c55e; --surface:#0b1020;
      --border:rgba(255,255,255,.12); --border-hover:rgba(255,255,255,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 600px at 70% -10%,rgba(99,102,241,.25),transparent),
        radial-gradient(900px 500px at 10% 10%,rgba(34,197,94,.2),transparent),
        var(--bg);
      color:var(--text);
      font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      overflow-x:hidden;
    }
    .wrap{max-width:1000px;margin:20px auto;padding:14px}
    .title{display:flex;align-items:center;justify-content:center;gap:12px;font-size:clamp(24px,2.8vw,34px);font-weight:800;letter-spacing:.2px;text-align:center;margin:6px 0 12px}
    .subtitle{color:var(--muted);text-align:center;margin-top:-6px;margin-bottom:14px}
    .grid{display:grid;gap:14px;grid-template-columns:1fr}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
    .card{
      background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
      border:1px solid var(--border);
      backdrop-filter: blur(8px);
      border-radius:14px; box-shadow:0 8px 30px rgba(0,0,0,.35)
    }
    .card h3{margin:0 0 8px;font-size:15px;color:#cbd5e1}.card .body{padding:12px}
    textarea{width:100%;min-height:220px;border-radius:10px;border:1px solid var(--border);background:var(--surface);color:var(--text);padding:12px;outline:none;resize:vertical}
    textarea:focus{border-color:rgba(99,102,241,.7);box-shadow:0 0 0 3px rgba(99,102,241,.18)}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);background:var(--surface);color:#eef1f7;padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn:hover{border-color:var(--border-hover)}.btn.primary{background:linear-gradient(135deg,var(--brand),#8b5cf6);border-color:transparent}.btn.success{background:linear-gradient(135deg,var(--brand2),#16a34a);border-color:transparent}
    .muted{color:var(--muted);font-size:13px}.opt{display:flex;align-items:center;gap:8px;padding:10px 12px;background:var(--surface);border:1px solid var(--border);border-radius:10px}.badge{display:inline-flex;align-items:center;gap:6px;font-size:12px;padding:6px 10px;border-radius:999px;border:1px dashed var(--border);color:#cbd5e1}
    .bubble{animation:pop .45s ease forwards;display:inline-block}@keyframes pop{from{transform:translateY(6px) scale(.98);opacity:0} to{transform:translateY(0) scale(1);opacity:1}}
    .footer{opacity:.8;text-align:center;font-size:12px;margin:14px 0}a{color:#c7d2fe}.opts{display:grid;grid-template-columns:1fr;gap:8px}@media(min-width:820px){.opts{grid-template-columns:1fr 1fr}}
    /* modal / toast */
    .modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:var(--card);border-radius:12px;padding:14px;z-index:10010;max-width:520px;box-shadow:0 10px 40px rgba(0,0,0,.5);display:none}
    .modal.show{display:block}
    .toast{position:fixed;right:16px;bottom:16px;background:rgba(0,0,0,.7);color:white;padding:10px 14px;border-radius:10px;z-index:10011;display:none}
    .toast.show{display:block}
    /* confetti */
    .confetti{position:fixed;z-index:9999;pointer-events:none;top:0;left:0;width:12px;height:12px;opacity:0.95;transform-origin:center}
    @keyframes confettiFall {
      0% { transform: translateY(-10vh) rotate(0deg); opacity:1; }
      100% { transform: translateY(110vh) rotate(720deg); opacity:0; }
    }
    @media(max-width:520px){.title{font-size:20px}.wrap{margin:12px;padding:12px}}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    /* ======= THEME VARIANTS ======= */
    body[data-theme] .card{ background: var(--card); border-color: var(--border); }
    body[data-theme] .btn.primary { background: linear-gradient(135deg, var(--brand), #8b5cf6); }
    body[data-theme] .btn.success { background: linear-gradient(135deg, var(--brand2), #16a34a); }

    /* footer helper classes added */
    .footer-links{display:flex;justify-content:center;gap:18px;margin-top:10px;flex-wrap:wrap}
    .footer-links a{color:var(--muted);text-decoration:none;font-size:13px}
    .footer-actions{margin-top:14px;display:flex;justify-content:center;gap:10px;flex-wrap:wrap}
    .footer-action-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:8px;text-decoration:none;font-weight:600;font-size:14px}
    .footer-action-btn.wa{background:#25D366;color:#fff}
    .footer-action-btn.github{background:#24292e;color:#fff}
  </style>
</head>
<body data-theme="neon">
  <noscript>
    <div style="background:#111;padding:10px;border-radius:6px;color:#fff;margin:12px auto;max-width:1000px;text-align:center">
      Javascript diperlukan agar aplikasi berjalan. Silakan aktifkan JavaScript.
    </div>
  </noscript>

  <div class="wrap" role="application" aria-label="Umandana Translator">
    <div class="title">
      <span class="doodle" id="doodlePlace" aria-hidden="true" role="img" title="ikon aplikasi">
        <svg viewBox="0 0 24 24" width="44" height="44" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 2c1.7 0 3 1.3 3 3s-1.3 3-3 3-3-1.3-3-3 1.3-3 3-3zM6 20c0-3.3 2.7-6 6-6s6 2.7 6 6H6z" fill="currentColor" opacity="0.95"/></svg>
      </span>
      <span>Umandana Translator</span>
    </div>

    <div class="row" style="justify-content:center; margin-bottom:8px">
      <label class="badge" style="cursor:pointer">
        Tema:
        <select id="themeSel" class="btn" aria-label="Pilih tema" style="padding:6px 10px;border-radius:8px">
          <option value="neon">Neon (default)</option>
          <option value="ocean">Ocean</option>
          <option value="sakura">Sakura</option>
          <option value="latte">Latte (terang)</option>
          <option value="jkt48">JKT48 (neon merah)</option>
          <option value="pahlawan">Hari Pahlawan ðŸ‡®ðŸ‡©</option>
          <option value="ayah">Hari Ayah â€” 12 November</option>
        </select>
        <button type="button" id="randomTheme" class="btn" style="margin-left:8px">Acak</button>
        <label class="badge" style="margin-left:8px;cursor:pointer"><input type="checkbox" id="autoRotate"> Rotasi 2 menit</label>
      </label>
    </div>

    <div class="subtitle">TUGU JUANG DURIAN LUNCUK</div>

    <div class="grid">
      <div class="card" aria-hidden="false">
        <div class="body">
          <h3>Teks Asli</h3>
          <textarea id="src" placeholder="Tulis teks di siniâ€¦" maxlength="5000" aria-label="Teks asli"></textarea>
          <div class="row" style="margin-top:8px">
            <button type="button" class="btn" id="clearBtn">Bersihkan</button>
            <span class="badge">Karakter: <span id="srcChars">0</span></span>
            <span class="badge">Kata: <span id="srcWords">0</span></span>
            <span class="sr-only" id="processingStatus" aria-live="polite"></span>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="body">
          <h3>Hasil</h3>
          <textarea id="dst" readonly aria-label="Hasil terjemahan"></textarea>
          <div class="row" style="margin-top:8px">
            <button type="button" class="btn primary" id="copyBtn">Salin</button>
            <button type="button" class="btn" id="shareBtn">Bagikan</button>
            <button type="button" class="btn success" id="downloadBtn">Unduh .txt</button>
            <span class="badge">Karakter: <span id="dstChars">0</span></span>
          </div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <div class="body">
        <div class="opts" role="region" aria-label="Opsi konversi">
          <label class="opt"><input type="radio" name="mode" id="modeIdToUm" checked> Indonesia â†’ Umandana</label>
          <label class="opt"><input type="radio" name="mode" id="modeUmToId"> Umandana â†’ Indonesia</label>
          <label class="opt" id="endOnlyWrap"><input type="checkbox" id="endOnly" checked> ES hanya di <b>konsonan akhir kata</b></label>
          <label class="opt" id="strictWrap"><input type="checkbox" id="strict"> Mode ketat: <b>semua konsonan +ES</b></label>
          <label class="opt"><input type="checkbox" id="upper" checked> Hasil <b>huruf besar</b></label>
        </div>
        <div class="muted" style="margin-top:8px">Aturan dasar: Aâ†’AIDEN, Iâ†’IPRI, Uâ†’UPRU, Eâ†’EPRE, Oâ†’OPRO, NGâ†’STRENG, konsonan +ES.</div>

        <div style="margin-top:12px; display:flex; gap:8px; align-items:center; flex-wrap:wrap">
          <label class="opt" id="analyticsWrap"><input type="checkbox" id="allowAnalytics"> Izinkan analytics (opsional)</label>
          <div class="muted">Jika diizinkan, data anonim akan dipakai untuk memperbaiki aplikasi.</div>
        </div>
      </div>
    </div>

    <!-- footer: ditambahkan link Privacy / Terms + tombol WA dan GitHub -->
    <div class="footer">
      Â© <span id="year"></span> â€” Umandana Translator. Dibuat oleh El Padri.
      <div class="footer-links" aria-hidden="false" style="margin-top:8px">
        <a href="privacy.html" id="linkPrivacy" target="_blank" rel="noopener noreferrer">Kebijakan Privasi</a>
        <a href="terms.html" id="linkTerms" target="_blank" rel="noopener noreferrer">Syarat &amp; Ketentuan</a>
        <a href="#" id="how">Contoh</a>
      </div>

      <div class="footer-actions" role="group" aria-label="Aksi Footer">
        <!-- ganti nomor WA di bawah dengan nomor kamu (format internasional tanpa +) -->
        <a class="footer-action-btn wa" href="https://wa.me/6285658379941" target="_blank" rel="noopener noreferrer">Hubungi Kami</a>

        <!-- ganti link repo GitHub sesuai repo Umandana kamu -->
        <a class="footer-action-btn github" href="https://github.com/ElPadri/umandana-translator" target="_blank" rel="noopener noreferrer">
          <!-- simple icon -->
          <svg height="16" width="16" viewBox="0 0 16 16" aria-hidden="true" focusable="false" style="fill:currentColor;">
            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38
            0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13
            -.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07
            -1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82
            .64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15
            0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2
            0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
          </svg>
          <span style="display:inline-block;margin-left:6px">GitHub</span>
        </a>
      </div>
    </div>
  </div>

  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true"></div>
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
(function(){
  document.getElementById('year').textContent = new Date().getFullYear();
  const el = id => document.getElementById(id);
  const src = el('src'), dst = el('dst');
  const copyBtn = el('copyBtn'), clearBtn = el('clearBtn'), shareBtn = el('shareBtn'), downloadBtn = el('downloadBtn');
  const endOnly = el('endOnly'), strict = el('strict'), upper = el('upper');
  const srcChars = el('srcChars'), srcWords = el('srcWords'), dstChars = el('dstChars'), how = el('how');
  const modeIdToUm = el('modeIdToUm'), modeUmToId = el('modeUmToId');
  const endOnlyWrap = el('endOnlyWrap'), strictWrap = el('strictWrap');
  const themeSel = el('themeSel'), randomThemeBtn = el('randomTheme'), autoRotate = el('autoRotate');
  const allowAnalytics = el('allowAnalytics');

  function debounce(fn, wait=180){ let t=null; return function(...args){ clearTimeout(t); t = setTimeout(()=> fn.apply(this,args), wait); }; }
  function showToast(text, time=2000){ const t = el('toast'); t.textContent = text; t.classList.add('show'); setTimeout(()=> t.classList.remove('show'), time); }
  function showModal(html){ const m = el('modal'); m.innerHTML = html; m.classList.add('show'); m.setAttribute('aria-hidden','false'); const btn = m.querySelector('button'); if(btn) btn.focus(); }
  function hideModal(){ const m = el('modal'); m.classList.remove('show'); m.setAttribute('aria-hidden','true'); }

  window.addEventListener('keydown',(e)=>{
    const meta = e.ctrlKey || e.metaKey;
    if(meta && (e.key === 'k' || e.key === 'K')){ e.preventDefault(); src.focus(); src.select(); }
    if(meta && e.key === 'Enter'){ e.preventDefault(); copyToClipboard(dst.value); showToast('Hasil disalin (shortcut)'); }
  });

  const THEMES = ['neon','ocean','sakura','latte','jkt48','pahlawan','ayah'];

  function setDoodleSvg(name){
    const d = el('doodlePlace');
    if(!d) return;
    if(name==='ayah'){
      d.innerHTML = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 3c1.657 0 3 1.343 3 3 0 .68-.226 1.307-.606 1.81L12 14 9.606 7.81A2.996 2.996 0 0 1 9 6c0-1.657 1.343-3 3-3zM6 20c0-3.314 2.686-6 6-6s6 2.686 6 6H6z" fill="currentColor"/></svg>';
    } else {
      d.innerHTML = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 2c1.7 0 3 1.3 3 3s-1.3 3-3 3-3-1.3-3-3 1.3-3 3-3zM6 20c0-3.3 2.7-6 6-6s6 2.7 6 6H6z" fill="currentColor"/></svg>';
    }
  }

  function applyTheme(name, {triggerConfetti=false} = {}){
    document.body.setAttribute('data-theme', name);
    localStorage.setItem('umandana-theme', name);
    setDoodleSvg(name);
    if(triggerConfetti && name==='ayah') createConfettiBurst();
  }

  const today = new Date();
  const isAyahDay = (today.getMonth()===10 && today.getDate()===12);
  const savedTheme = localStorage.getItem('umandana-theme') || (isAyahDay ? 'ayah' : 'neon');
  applyTheme(savedTheme);
  if(themeSel) themeSel.value = savedTheme;

  if(themeSel) themeSel.addEventListener('change', (e) => applyTheme(e.target.value, {triggerConfetti:true}));
  if(randomThemeBtn) randomThemeBtn.addEventListener('click', ()=>{
    let pick;
    do{ pick = THEMES[Math.floor(Math.random()*THEMES.length)]; } while(pick === document.body.getAttribute('data-theme'));
    if(themeSel) themeSel.value = pick;
    applyTheme(pick, {triggerConfetti:true});
  });

  let rotateTimer = null;
  function startRotate(){ stopRotate(); rotateTimer = setInterval(()=> randomThemeBtn.click(), 2*60*1000); }
  function stopRotate(){ if(rotateTimer){ clearInterval(rotateTimer); rotateTimer = null; } }
  if(autoRotate) autoRotate.addEventListener('change', (e)=> e.target.checked ? startRotate() : stopRotate());

  // confetti functions
  function rand(min,max){ return Math.random()*(max-min)+min; }
  const COLORS = ['#ffd166','#22c55e','#4ade80','#ff7ab6','#ffd1a9','#a7f3d0','#fff29b'];
  function createConfettiPiece(x, delay){
    const elc = document.createElement('div');
    elc.className = 'confetti';
    const size = Math.floor(rand(8,14));
    elc.style.width = size + 'px';
    elc.style.height = (size*0.6) + 'px';
    elc.style.left = x + 'px';
    elc.style.top = '-20px';
    elc.style.background = COLORS[Math.floor(Math.random()*COLORS.length)];
    elc.style.borderRadius = (Math.random()>0.5? '2px' : '50%');
    elc.style.transform = `rotate(${rand(0,360)}deg)`;
    const duration = rand(2200,3600);
    elc.style.animation = `confettiFall ${duration}ms cubic-bezier(.2,.8,.2,1) ${delay}ms forwards`;
    document.body.appendChild(elc);
    setTimeout(()=>{ try{ elc.remove(); }catch(e){} }, duration + delay + 400);
  }
  function createConfettiBurst(){
    const count = 28;
    const w = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
    for(let i=0;i<count;i++){
      createConfettiPiece(rand(20, w-20), Math.floor(rand(0,280)));
    }
    setTimeout(()=> {
      for(let i=0;i<10;i++) createConfettiPiece((w/2)+rand(-120,120), 120+Math.floor(rand(0,200)));
    }, 350);
  }
  if(savedTheme === 'ayah' || isAyahDay) setTimeout(()=> createConfettiBurst(), 500);

  // === translator logic (sama seperti sebelum) ===
  function isLetter(ch){ return /[A-Za-z]/.test(ch); }
  function isVowel(ch){ return /[AEIOUaeiou]/.test(ch); }
  const vokalMap = { A:'AIDEN', a:'aiden', I:'IPRI', i:'ipri', U:'UPRU', u:'upru', E:'EPRE', e:'epre', O:'OPRO', o:'opro' };
  function plusEs(ch, up){ const base = up ? ch.toUpperCase() : ch.toLowerCase(); return base + (up ? 'ES' : 'es'); }
  function matchCase(replacement, example){
    if(!example) return replacement;
    if(example.toUpperCase() === example) return replacement.toUpperCase();
    if(example.toLowerCase() === example) return replacement.toLowerCase();
    return replacement[0].toUpperCase() + replacement.slice(1).toLowerCase();
  }

  function encodeUmandana(input){
    if(!input) return '';
    const up = upper.checked;
    const useEndOnly = endOnly.checked && !strict.checked;
    const words = input.split(/(\s+)/);
    const converted = words.map(token => {
      if(/^\s+$/.test(token)) return token;
      const parts = token.match(/[A-Za-z]+|[^A-Za-z]+/g) || [token];
      const convParts = parts.map(part => {
        if(!/[A-Za-z]/.test(part)) return part;
        let out = '';
        const letters = part.split('');
        for(let i=0;i<letters.length;i++){
          const ch = letters[i];
          const next = letters[i+1]||'';
          if((ch==='N'||ch==='n') && (next==='G'||next==='g')){ out += up ? 'STRENG' : 'streng'; i++; continue; }
          if(isVowel(ch)){ out += vokalMap[ch] ?? ch; continue; }
          if(isLetter(ch)){ if(strict.checked){ out += plusEs(ch, up); } else { out += up ? ch.toUpperCase() : ch.toLowerCase(); } continue; }
          out += ch;
        }
        if(useEndOnly){
          const lastAlpha = (part.match(/[A-Za-z](?=[^A-Za-z]*$)/)||[''])[0];
          if(lastAlpha && !isVowel(lastAlpha)){
            const endsWithStreng = out.endsWith(up?'STRENG':'streng');
            if(!endsWithStreng) out += up?'ES':'es';
          }
        }
        return out;
      });
      return convParts.join('');
    });
    return converted.join('');
  }

  function decodeUmandana(input){
    if(!input) return '';
    const tokens = input.split(/(\s+)/);
    const decoded = tokens.map(tok => {
      if(/^\s+$/.test(tok)) return tok;
      const parts = tok.match(/[A-Za-z]+|[^A-Za-z]+/g) || [tok];
      const conv = parts.map(part => {
        if(!/[A-Za-z]/.test(part)) return part;
        let s = part;
        s = s.replace(/streng/gi, m => matchCase('ng', m));
        s = s.replace(/aiden/gi, m => matchCase('a', m))
             .replace(/ipri/gi,  m => matchCase('i', m))
             .replace(/upru/gi,  m => matchCase('u', m))
             .replace(/epre/gi,  m => matchCase('e', m))
             .replace(/opro/gi,  m => matchCase('o', m));
        s = s.replace(/([bcdfghjklmnpqrstvwxyz])es\b/gi, '$1');
        return s;
      });
      return conv.join('');
    });
    return decoded.join('');
  }

  function syncOptionsVisibility(){ const decoding = modeUmToId.checked; endOnly.disabled = decoding; strict.disabled = decoding; endOnlyWrap.style.opacity = decoding ? .6 : 1; strictWrap.style.opacity = decoding ? .6 : 1; }

  function compute(){
    const val = src.value;
    const outRaw = modeUmToId.checked ? decodeUmandana(val) : encodeUmandana(val);
    const out = upper.checked ? outRaw.toUpperCase() : outRaw;
    dst.value = out;
    srcChars.textContent = val.length;
    srcWords.textContent = (val.trim() ? val.trim().split(/\s+/).filter(w=>/[A-Za-z0-9]/.test(w)).length : 0);
    dstChars.textContent = dst.value.length;
    el('processingStatus').textContent = '';
    dst.classList.remove('bubble'); void dst.offsetWidth; dst.classList.add('bubble');
  }

  const update = debounce(()=>{ compute(); }, 140);

  src.addEventListener('input', ()=>{ const long = src.value.length > 2000; if(long) el('processingStatus').textContent = 'Memproses teks panjang...'; update(); });
  endOnly.addEventListener('change', update);
  strict.addEventListener('change', ()=>{ if(strict.checked) endOnly.checked=false; update(); });
  upper.addEventListener('change', update);
  modeIdToUm.addEventListener('change', ()=>{ syncOptionsVisibility(); update(); });
  modeUmToId.addEventListener('change', ()=>{ syncOptionsVisibility(); update(); });
  clearBtn.addEventListener('click', ()=>{ src.value=''; update(); src.focus(); });

  async function copyToClipboard(text){
    try{ await navigator.clipboard.writeText(text); showToast('Hasil disalin!'); }
    catch(e){ const ta = document.createElement('textarea'); ta.value = text; document.body.appendChild(ta); ta.select(); try{ document.execCommand('copy'); showToast('Hasil disalin (fallback)'); } catch(_){ showToast('Gagal menyalin, silakan salin manual'); } ta.remove(); }
  }
  copyBtn.addEventListener('click', async ()=>{ await copyToClipboard(dst.value); });
  shareBtn.addEventListener('click', async ()=>{ const text = dst.value || ''; if(navigator.share){ try{ await navigator.share({title:'Umandana', text}); } catch(e){} } else { showModal('<strong>Bagikan</strong><p>Peramban tidak mendukung Web Share API. Silakan salin hasil secara manual.</p><p><button class="btn" id="modalClose">Tutup</button></p>'); document.getElementById('modalClose').addEventListener('click', hideModal); } });
  downloadBtn.addEventListener('click', ()=>{
    const blob = new Blob([dst.value], {type:'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'umandana.txt'; a.click(); URL.revokeObjectURL(url);
    showToast('File unduhan dibuat');
  });

  how.addEventListener('click', (e)=>{ e.preventDefault(); const contoh = [ ['RUMAH','RUPRU MAHES'], ['ASING','AIDEN SIPRI STRENG'], ['MATA','MAIDEN TAIDEN'], ['BOLA','BOPRO LAIDEN'], ['DUNIA','DUPRU NIPRI AIDEN'] ].map(([a,b])=>`â€¢ ${a} â†’ ${b}`).join('\n'); showModal('<strong>Contoh:</strong><pre style="white-space:pre-wrap">'+contoh+'</pre><p><button class="btn" id="modalOk">Tutup</button></p>'); document.getElementById('modalOk').addEventListener('click', hideModal); });

  src.value = 'KITA PERGI MAKAN DI RUMAH TEMAN MALAM INI';
  syncOptionsVisibility(); update();

  // service worker registration (sama seperti sebelumnya)
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('/sw.js').then(reg=>{
      if(reg.waiting){ showToast('Versi baru tersedia â€” muat ulang halaman untuk memperbarui'); }
      reg.addEventListener('updatefound', ()=> {
        const installing = reg.installing;
        installing.addEventListener('statechange', ()=> {
          if(installing.state === 'installed' && navigator.serviceWorker.controller){
            showModal('<strong>Pembaruan tersedia</strong><p>Versi baru aplikasi tersedia. Segera muat ulang agar perubahan diterapkan.</p><p><button class="btn" id="reloadNow">Muat Ulang</button> <button class="btn" id="dismiss">Nanti</button></p>');
            document.getElementById('reloadNow').addEventListener('click', ()=>{ location.reload(true); });
            document.getElementById('dismiss').addEventListener('click', hideModal);
          }
        });
      });
    }).catch(()=>{ /* ignore sw fail */ });
    navigator.serviceWorker.addEventListener('message', evt => { if(evt.data && evt.data.type === 'RELOAD_PAGE') location.reload(); });
  }

  // analytics opt-in kept as before (no auto-init unless you configure)
  const pref = localStorage.getItem('umandana-allow-analytics');
  if(pref === 'true'){ if(allowAnalytics) allowAnalytics.checked = true; initFirebase(true); } else { if(allowAnalytics) allowAnalytics.checked = false; }
  if(allowAnalytics) allowAnalytics.addEventListener('change', (e)=>{ const allow = !!e.target.checked; localStorage.setItem('umandana-allow-analytics', allow ? 'true' : 'false'); if(allow) initFirebase(true); else showToast('Analytics dimatikan (opsional)'); });

  async function initFirebase(enable){
    if(!enable) return;
    // safe check: don't attempt if config placeholders still present
    const firebaseConfig = {
      apiKey: "REPLACE_API_KEY",
      authDomain: "REPLACE_AUTH_DOMAIN",
      projectId: "REPLACE_PROJECT_ID",
      storageBucket: "REPLACE_STORAGE_BUCKET",
      messagingSenderId: "REPLACE_MESSAGING_SENDER_ID",
      appId: "REPLACE_APP_ID",
      measurementId: "REPLACE_MEASUREMENT_ID"
    };
    if(!firebaseConfig.measurementId || firebaseConfig.measurementId.includes('REPLACE')){
      console.warn('Firebase analytics not initialized â€” measurementId missing.');
      return;
    }
    try{
      const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js');
      const { getAnalytics, logEvent } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-analytics.js');
      const { getPerformance } = await import('https://www.gstatic.com/firebasejs/10.7.0/firebase-perf.js');
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      try{ getPerformance(app); }catch(e){}
      window._um_analytics = analytics;
      logEvent(analytics, 'app_opened');
      showToast('Analytics aktif (anonim)');
    }catch(e){ console.warn('Firebase init gagal', e); showToast('Analytics tidak tersedia'); }
  }

})();
</script>

</body>
</html>
